services:
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: Root
      MYSQL_DATABASE: News_Update_Aggregator
    ports:
      - "3307:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    networks:
      - app-network

  rabbitmq:
    image: "rabbitmq:3-management"
    ports:
      - "15672:15672"
      - "5672:5672"
    networks:
      - app-network

  news-fetcher-service:
    build: news-fetcher-service
    command: ["dapr", "run", "--app-id", "news-fetcher-service", "--app-port", "5000", "--resources-path", "/components", "--", "python", "NewsFetcherService.py"]
    ports:
      - "5000:5000"
    depends_on:
      - rabbitmq
      - mysql
    environment:
      - DATABASE_HOST=mysql
      - DATABASE_USER=root
      - DATABASE_PASSWORD=Root
      - DATABASE_NAME=News_Update_Aggregator
    volumes:
      - ./news-fetcher-service/config.yaml:/app/config.yaml
      - dapr_components:/components
    networks:
      - app-network

  user-service:
    build: user-service
    command: ["dapr", "run", "--app-id", "user-service", "--app-port", "5001", "--resources-path", "/components", "--", "python", "UserService.py"]
    ports:
      - "5001:5001"
    depends_on:
      - rabbitmq
      - mysql
    environment:
      - DATABASE_HOST=mysql
      - DATABASE_USER=root
      - DATABASE_PASSWORD=Root
      - DATABASE_NAME=News_Update_Aggregator
    volumes:
      - ./user-service/config.yaml:/app/config.yaml
      - dapr_components:/components
    networks:
      - app-network

  news-aggregator-service:
    build: news-aggregator-service
    command: ["dapr", "run", "--app-id", "news-aggregator-service", "--app-port", "5002", "--resources-path", "/components", "--", "python", "NewsAggregatorService.py"]
    ports:
      - "5002:5002"
    depends_on:
      - rabbitmq
      - mysql
    environment:
      - DATABASE_HOST=mysql
      - DATABASE_USER=root
      - DATABASE_PASSWORD=Root
      - DATABASE_NAME=News_Update_Aggregator
    volumes:
      - ./news-aggregator-service/config.yaml:/app/config.yaml
      - dapr_components:/components
    networks:
      - app-network

  notification-service:
    build: notification-service
    command: ["dapr", "run", "--app-id", "notification-service", "--app-port", "5003", "--resources-path", "/components", "--", "python", "NotificationService.py"]
    ports:
      - "5003:5003"
    depends_on:
      - rabbitmq
      - mysql
    environment:
      - DATABASE_HOST=mysql
      - DATABASE_USER=root
      - DATABASE_PASSWORD=Root
      - DATABASE_NAME=News_Update_Aggregator
    volumes:
      - ./notification-service/config.yaml:/app/config.yaml
      - dapr_components:/components
    networks:
      - app-network

volumes:
  dapr_components:
    driver: local
  mysql_data:
    driver: local

networks:
  app-network:
    driver: bridge
